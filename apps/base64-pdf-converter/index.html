<!doctype html>
<html lang="en">
  <head>
    <title>kellner.team Base64 to HTML Converter</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/spcss@0.9.0" />
  </head>
  <body>
    <h1>kellner.team Base64 to HTML Converter</h1>
    <div style="display: flex; flex-direction: column; gap: 1rem">
      <label for="base64Input">Enter Base64 String:</label>
      <div style="display: flex; flex-direction: column">
        <textarea id="base64Input" rows="4" cols="50"></textarea>
        <small>Or provide it via ?base64= param</small>
      </div>
      <div>
        <button id="click-button" onclick="convertBase64ToPDF()">Convert to PDF</button>
      </div>
      <div id="pdfViewer">
        <!-- PDF will be displayed here -->
      </div>
    </div>

    <script>
      function urlSafeToBase64(urlSafe) {
        urlSafe = urlSafe.replace(/-/g, '+').replace(/_/g, '/');
        while (urlSafe.length % 4) {
          urlSafe += '=';
        }
        return urlSafe;
      }

      // Function to get URL parameter by name
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

      // Function to set base64 input value from URL parameter
      function setInputFromURLParam() {
        const base64Param = getParameterByName('base64');
        if (base64Param) {
          document.getElementById('base64Input').value = urlSafeToBase64(base64Param);
          setTimeout(() => document.getElementById('click-button').click(), 0);
        }
      }

      // Initialize input from URL parameter on page load
      setInputFromURLParam();

      async function convertBase64ToPDF() {
        const base64Input = document.getElementById('base64Input').value;
        const pdfViewer = document.getElementById('pdfViewer');

        if (!base64Input) {
          alert('Please enter a valid Base64 string.');
          return;
        }

        // Decode the base64 string
        const binaryData = atob(base64Input);

        // Convert binary data to array buffer
        const arrayBuffer = new ArrayBuffer(binaryData.length);
        const uint8Array = new Uint8Array(arrayBuffer);
        for (let i = 0; i < binaryData.length; i++) {
          uint8Array[i] = binaryData.charCodeAt(i);
        }

        // Display the PDF
        const blob = new Blob([uint8Array], { type: 'application/pdf' });
        pdfViewer.innerHTML = '<embed src="' + URL.createObjectURL(blob) + '" type="application/pdf" width="100%" height="600px"/>';
      }
    </script>
  </body>
</html>
